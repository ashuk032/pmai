{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Components</h1>
<form method="get" class="mb-4 flex flex-wrap gap-3 items-end">
  <div>
    <label class="block text-xs text-slate-500 mb-1">Component Type</label>
    <select name="type" class="border rounded px-2 py-1 text-sm">
      <option value="">All</option>
      {% for t in types %}
        <option value="{{ t }}" {% if f_type==t %}selected{% endif %}>{{ t }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label class="block text-xs text-slate-500 mb-1">Priority</label>
    <select name="priority" class="border rounded px-2 py-1 text-sm">
      <option value="">All</option>
      <option value="High" {% if f_prio=='High' %}selected{% endif %}>High</option>
      <option value="Medium" {% if f_prio=='Medium' %}selected{% endif %}>Medium</option>
      <option value="Low" {% if f_prio=='Low' %}selected{% endif %}>Low</option>
    </select>
  </div>
  <div>
    <label class="block text-xs text-slate-500 mb-1">Thresholds</label>
    <div class="flex items-center gap-2 text-xs text-slate-600">
      <span>Med≥</span>
      <input type="number" name="thresh_med" step="0.05" min="0" max="1" value="{{ th_med }}" class="w-20 border rounded px-2 py-1 text-sm">
      <span>High≥</span>
      <input type="number" name="thresh_high" step="0.05" min="0" max="1" value="{{ th_high }}" class="w-20 border rounded px-2 py-1 text-sm">
    </div>
  </div>
  <div>
    <label class="block text-xs text-slate-500 mb-1">Per page</label>
    <input type="number" name="per_page" min="5" max="50" value="{{ per_page }}" class="w-24 border rounded px-2 py-1 text-sm">
  </div>
  <div class="flex gap-2">
    <button class="bg-slate-800 text-white text-sm rounded px-3 py-1.5" type="submit">Apply</button>
    <a class="text-sm border rounded px-3 py-1.5" href="/components">Reset</a>
  </div>
</form>

<div class="overflow-x-auto bg-white border rounded-lg">
  <table class="min-w-full text-sm">
    <thead class="text-slate-500 sticky top-0 bg-white">
      <tr>
        <th class="text-left py-2 pr-4">ID</th>
        <th class="text-left py-2 pr-4">Type</th>
        <th class="text-left py-2 pr-4">Risk %</th>
        <th class="text-left py-2 pr-4">Priority</th>
        <th class="text-left py-2 pr-4">TTF (hrs)</th>
        <th class="text-left py-2 pr-4">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr class="border-t hover:bg-slate-50">
        <td class="py-2 pr-4">{{ r.component_id }}</td>
        <td class="py-2 pr-4">{{ r.component_type }}</td>
        <td class="py-2 pr-4 font-medium">{{ (r.risk * 100) | round(1) }}</td>
        <td class="py-2 pr-4">
          <span class="px-2 py-0.5 rounded text-xs
            {% if r.priority == 'High' %} bg-red-100 text-red-700
            {% elif r.priority == 'Medium' %} bg-amber-100 text-amber-700
            {% else %} bg-emerald-100 text-emerald-700 {% endif %}">
            {{ r.priority }}
          </span>
        </td>
        <td class="py-2 pr-4">{{ r.ttf_hours | round(1) }}</td>
        <td class="py-2 pr-4"><a class="text-blue-600 hover:underline" href="/component/{{ r.component_id }}">View</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="mt-4 flex items-center justify-between">
  <div class="text-xs text-slate-500">Page {{ page }} of {{ total_pages }} • {{ total_items }} items</div>
  <div class="flex gap-2">
    {% set prevp = page - 1 %}
    {% set nextp = page + 1 %}
    <a class="text-sm border rounded px-3 py-1.5 {% if page <= 1 %}opacity-50 pointer-events-none{% endif %}"
       href="/components?page={{ prevp }}&per_page={{ per_page }}&type={{ f_type }}&priority={{ f_prio }}&thresh_med={{ th_med }}&thresh_high={{ th_high }}">Prev</a>
    <a class="text-sm border rounded px-3 py-1.5 {% if page >= total_pages %}opacity-50 pointer-events-none{% endif %}"
       href="/components?page={{ nextp }}&per_page={{ per_page }}&type={{ f_type }}&priority={{ f_prio }}&thresh_med={{ th_med }}&thresh_high={{ th_high }}">Next</a>
  </div>
</div>
{% endblock %}
